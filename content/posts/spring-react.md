---
title: "Spring boot와 React.js의 만남"
date: 2020-01-22T18:06:35+09:00
---

# Spring boot(백엔드)와 React.js(프론트엔드)의 만남

[ Reference ] : <https://spring.io/guides/tutorials/react-and-spring-data-rest/>

[ Spring Initializr ] : <https://start.spring.io/> 

## 1단계 Spring Initializr 

아래의 Dependencies 를 추가해서 Generate 합니다.

- Rest Repositories
- Thymeleaf
- JPA
- H2

만들어진 스프링 프로젝트를 압축해제 합니다.

## 2단계 첫 java 파일

IDE로 스프링프로젝트를 엽니다.

- Spring Data REST 를 사용하므로 간편하게 작업할 수 있습니다.

### domain 선언

>Employee.java

```java
package com.mjseok.springreact;

import java.util.Objects;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;

@Entity
public class Employee {

    private @Id @GeneratedValue Long id;
    private String firstName;
    private String lastName;
    private String description;

    private Employee() {}

    public Employee(String firstName, String lastName, String description) {
        this.firstName = firstName;
        this.lastName = lastName;
        this.description = description;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;

        Employee employee = (Employee) o;

        return Objects.equals(id, employee.id) &&
               Objects.equals(firstName, employee.firstName) &&
               Objects.equals(lastName, employee.lastName) &&
               Objects.equals(description, employee.description);
    }

    @Override
    public int hashCode() {
        return Objects.hash(id, firstName, lastName, description);
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getFirstName() {
        return firstName;
    }

    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }

    public String getLastName() {
        return lastName;
    }

    public void setLastName(String lastName) {
        this.lastName = lastName;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    @Override
    public String toString() {
        return "Employee{" +
               "id=" + id +
               ", firstName='" + firstName + '\'' +
               ", lastName='" + lastName + '\'' +
               ", description='" + description + '\'' +
               '}';
    }
}
```

- @Entity : 관계형 테이블을 저장하기 위한 클래스 JPA 어노테이션
- @Id @GeneratedValue : 기본키(PK)를 자동적으로 생성하는 어노테이션

## 3단계 저장소 정의 (Defining the repository)

- Spring Data REST에서는 해당하는 저장소의 정의를 작성하는 것이 포인트입니다.

> EmployeeRepository.java

```java
import org.springframework.data.repository.CrudRepository;

public interface EmployeeRepository extends CrudRepository<Employee, Long> {
    
}
```

- 저장소는 Spring 프레임워크의 Data Commons의 CrudRepository를 상속합니다.
- 그 저장소는 방금 만든 도메인 객체와 기본키를 제네릭 타입으로 받습니다.
- 이 것으로 전부입니다. 이미 메소드가 사전 정의되어있기 때문입니다.

> CrudRepository.class

```java
 // Failed to get sources. Instead, stub sources have been generated by the disassembler.
 // Implementation of methods is unavailable.
package org.springframework.data.repository;
public abstract interface CrudRepository<T,ID> extends org.springframework.data.repository.Repository {
  
  public abstract <S extends T> S save(S arg0);
  
  public abstract <S extends T> java.lang.Iterable<S> saveAll(java.lang.Iterable<S> arg0);
  
  public abstract  java.util.Optional<T> findById(ID arg0);
  
  public abstract  boolean existsById(ID arg0);
  
  public abstract  java.lang.Iterable<T> findAll();
  
  public abstract  java.lang.Iterable<T> findAllById(java.lang.Iterable<ID> arg0);
  
  public abstract long count();
  
  public abstract  void deleteById(ID arg0);
  
  public abstract  void delete(T arg0);
  
  public abstract  void deleteAll(java.lang.Iterable<? extends T> arg0);
  
  public abstract void deleteAll();
}
```

## 4단계 더미 로딩하기

- 애플리케이션을 실행하기 위해 미리 더미 데이터를 집어 넣습니다.

> DatabaseLoader.java

```java
package com.mjseok.springreact;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;

@Component
public class DatabaseLoader implements CommandLineRunner {
    
    private final EmployeeRepository repository;

    @Autowired
    public DatabaseLoader(EmployeeRepository repository) {
        this.repository = repository;
    }

    @Override
    public void run(String... strings) throws Exception {
        this.repository.save(new Employee("Frodo", "Baggins", "ring bearer"));
    }
}
```

- @Component가 표기된 클래스는 자동으로 @SpringBootApplication에 의해 선택됩니다.
- CommandLineRunner를 구현하여 모든 beans을 생성 및 등록 후 실행하게 합니다.
- 생성자 주입 및 AutoWiring을 통해 자동으로 EmployeeRepository를 가져옵니다.
- run() 메소드는 커맨드 명령과 같이 호출되며, 더미 데이터를 저장합니다.

### Spring Data의 강력한 기능

- JPA 쿼리를 작성해줍니다.
- 개발 시간을 줄여줄 뿐만 아니라, 버그와 오류 위험도 줄여줍니다.
- Spring Data는 저장소 class가 상속받은 메소드로 CRUD 작업을 진행합니다.
- 빈 인터페이스를 작성했지만, CRUD를 편하게 할 수 있습니다!

## 5단계 root URL 수정하기 (Adjusting the root URI)

- 기본 값으로 Spring Data REST는 ``/`` 를 바라보고 있기에
- 그 곳은 프론트엔드(React)를 위해서 백엔드(Spring) 루트를 변경해줍니다.

> src/main/resources/application.properties

```properties
spring.data.rest.base-path=/api
```

## 6단계 백엔드 서버 실행하기!

- 마지막 단계는 Spring Boot를 사용해 ``public static void main``를 작성하는 것입니다.

> SpringReactApplication.java

```java
package com.mjseok.springreact;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class SpringReactApplication {
	
	public static void main(String[] args) {
		SpringApplication.run(SpringReactApplication.class, args);
	}
}
```

- maven이 설치되어 있지 않다면 maven을 먼저 설치합시다.

[ maven ] : <https://maven.apache.org/>

```bash
mvn spring-boot:run
```

- 감격스러운 백엔드 REST API가 완성되었습니다.

<http://localhost:8080/api>

- root 에는 ``_links`` 로 묶인 컬렉션이 HAL-formatted JSON 형태로 보여집니다.
- HAL - Hypertext Application Language
- HAL은 API 내에서 리소스를 하이퍼링크해 일관되고 쉬운 방법을 제시합니다.
- 아래 링크를 참고하시면 상세 내용을 읽을 수 있습니다.

<http://stateless.co/hal_specification.html>

### 부록. Windows 환경 POST로 데이터 보내기

```bash
$employee = @{
    firstName='a'
    lastName='b'
    description='c'
}
$json = $employee | ConvertTo-Json
Invoke-RestMethod 'http://localhost:8080/api/employees' -Method Post -Body $json -ContentType 'application/json'
```
